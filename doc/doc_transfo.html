<!DOCTYPE html>
<html lang="en-us"><head>
<title>
OptiTrust Documentation
</title>
<meta charset="utf-8">
   <!--Make sure to load the CSS file in that order-->
   <link rel="stylesheet" type="text/css" href="../tools/lib/highlight.js_github.min.css" />
   <link rel="stylesheet" type="text/css" href="../tools/lib/diff2html.min.css" />

   
   <!--custom highlightjs with only ocaml and C/C++ supported-->
   <script src="../tools/lib/highlight_custom/highlight.pack.js"></script>

   <script src="../tools/lib/jquery.min.js"></script>
   <script src="../tools/lib/jquery-ui.min.js"></script>
   <script type="text/javascript" src="../tools/lib/diff2html-ui.min.js"></script>
   <!--TODO: http://underscorejs.org/ ? -->


   <!--explicit inclusion of files-->
   <!--<script src="split_loop_doc.js"></script>-->


<style>
/* Hide the filename since we're concerned with only one file name */
.d2h-file-header {
   display: none;
}

/* Hide the diff line number because we're showing full file comparisons */
.d2h-info {
   display: none;
}

.title {
   font-size: 300%;
   font-weight: bold;
   text-align: center;
}

h1 {
   padding: 4px;
   /*color: #0000CC;*/
   background: #DDFFFF;
}

h2 {
   padding: 4px;
   /*color: #006600;*/
   background: #00FFFF;
   padding-left: 1em;
}

.spec {
}

.doc {

}

.src {
   border: 2px solid black;
   padding: 1px 5px 1px 5px;
   background: #FFFFA0;
   font-weight: bold;
}

.diff {
   margin: 2px 0px 2px 0px;
}

.error {
   padding: 2em;
   background: red;
   font-weight: bold;
   font-size: 2em;
}

.warning {
   padding: 1em;
   background: red;
   font-weight: bold;
   font-size: 1em;
}
</style>

<script>
var enableWarning = false;

var configuration = { 
   inputFormat: 'json', 
   drawFileList: false,
   // fileListToggle: false,
   // fileListStartVisible: false
   fileContentToggle: false,
   matching: 'lines', 
   outputFormat: 'side-by-side',
   synchronisedScroll: true,
   highlight: true,
   renderNothingWhenEmpty: false,
   // LATER tune?
   // matchWordsThreshold : similarity threshold for word matching, default is 0.25
   // matchWordsThresholdmatchingMaxComparisons: perform at most this much comparisons for line matching a block of changes, default is 2500
   // maxLineSizeInBlockForComparison: maximum number os characters of the bigger line in a block to apply comparison, default is 200
   // maxLineLengthHighlight: only perform diff changes highlight if lines are smaller than this, default is 10000
   };

// TODO: the horizontal scrollbars should not be needed if the diff contains no long lines.


// Could use Underscore's _escape method.
function escapeHTML(s) {
   return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
}

function loadDiffFromString(targetId, diffString) {
   // this function should be called only after DOM contents is loaded
  var targetElement = document.getElementById(targetId);
  var diff2htmlUi = new Diff2HtmlUI(targetElement, diffString, configuration);
  diff2htmlUi.draw();
  diff2htmlUi.highlightCode();
}

// removes from src everything between the line that contains ".cpp" or "fun" and the line that contains "dump" or ")"
function shrinkSrc(src) {
   src = src.replace("\n\n","\n");
   src = src.replace("  \n\n","\n");
   var start = src.indexOf(".cpp");
   if (start == -1) 
      start = src.indexOf("fun _");
   if (start == -1) 
      return src;
   start = src.indexOf("\n", start);
   if (start == -1)
      return src;
   src = src.substr(start+1);
   var stop = src.lastIndexOf("dump");
   if (stop == -1) {
      stop = src.lastIndexOf(")");
   }
   if (stop != -1) {
      return src.substr(0,stop);
   }
   return src;
}

function reportError(targetId, targetJsFilename) {
   $('#'+targetId).html("Error loading " + targetJsFilename + ". Check that you open the chromium browser with flag --disable-web-security, e.g., via 'make opendoc', and that all the *_doc.js files have been generated using 'make doc'. Alternatively, the '*_doc.js' file needs to be included explicitly in _doc.html.").addClass("error");
}

function loadTestFromFileAssumedLoaded(targetId, targetName, sWarning) {
   // function names
   var targetJsFunctionSpec = "get_spec_" + targetId;
   var targetJsFunctionSrc = "get_src_" + targetId;
   var targetJsFunctionDiff = "get_diff_" + targetId;
   // Fill the test block
   var specId = targetId + "_doc";
   var srcId = targetId + "_src";
   var diffId = targetId + "_diff";
   var contents = "<div class='doc' id='"+specId+"'></div><div class='src' id='"+srcId+"'></div><div class='diff' id='"+diffId+"'></div>";
   $('#'+targetId).html(contents);

   // Fill the spec part
   var specContents = eval(targetJsFunctionSpec + "()");
   $('#'+specId).html("<pre>"+specContents+"</pre>");

   // Fill the source part 
   var srcContents = eval(targetJsFunctionSrc + "()");
   var srcHTML = "<pre><code class='ocaml'>"+escapeHTML(shrinkSrc(srcContents))+"</code></pre>";
   var srcWarning = "";
   if (enableWarning && sWarning) {
      srcWarning = "<div class='warning'>" + sWarning + "</div>";
   }
   $('#'+srcId).html(srcWarning + srcHTML);
   //hljs.highlightElement(srcId);

   // Fill the diff part
   var diffContents = eval(targetJsFunctionDiff + "()");
   loadDiffFromString(diffId, diffContents);
}

function loadTestFromFile(targetId) {
   var targetName = targetId.replace("__", "/");
   var targetJsFilename = "../tests/" + targetName + "_doc.js";

   try { // try loading from an include
      loadTestFromFileAssumedLoaded(targetId, targetName);
   } catch (error) {
      // The dynamic loading of the JS file requires --disable-web-security
      $.getScript(targetJsFilename, function(data, status) {
         if (status != "success") {
            reportError(targetId, targetJsFilename);
            return;
         }
         loadTestFromFileAssumedLoaded(targetId, targetName, "Warning: JS file loaded the unsafe way.");
      }).fail(function () {
         reportError(targetId, targetJsFilename);
      });
   }

}

function loadAllTestFromFile() {
   var all = $(".test").each(function() {
     loadTestFromFile(this.id);
   }); 
}

document.addEventListener('DOMContentLoaded', function () {
   loadAllTestFromFile();

});


/*
var all = $(".mbox").map(function() {
    return this.innerHTML;
}).get();

$("button").click(function(){
  $.getScript("demo_ajax_script.js");
});
*/
</script>

</head>

<body>

<div class="title">OptiTrust Documentation</div>


<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<h1>AST management</h1>

<!---------------------------------------------------------------------------->
<h2>Labels</h2>

<div class="test" id="basic__label_add"></div>

<div class="test" id="basic__label_remove"></div>


<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<h1>Data layout</h1>


<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<h1>Control Flow</h1>

<!---------------------------------------------------------------------------->
<h2>Loop Splitting</h2>

<div class="test" id="combi__loop_fusion"></div>


<!--


<div class="test" id="basic__array_swap"></div>

<div class="test" id="basic__array_tile"></div>

<div class="test" id="basic__loop_fusion"></div>

<div class="test" id="basic__sequence_elim"></div>
-->


<!---------------------------------------------------------------------------->
<!--<h2>Loop Tiling</h2>

<div class="test" id="test_tile_loop"></div>-->

<!---------------------------------------------------------------------------->
<h2>Other Transformations</h2>


<!---------------------------------------------------------------------------->
<h2>Domain-Specific Transformations</h2>


<!---------------------------------------------------------------------------->
<h2>Coloring</h2>

<!--<div class="test" id="loop_coloring"></div>
TESTS_WORKING := \
	aos_to_soa_sized_array.ml \
	aos_to_soa_typedef.ml \
	array_swap.ml \
	array_tile.ml \
	array_to_variables.ml \
	flow_insert_if.ml \
	function_bind_intro.ml \
	function_inline.ml \
	label_add.ml \
	label_remove.ml \
	local_name.ml \
	loop_color.ml \
	loop_fission.ml \
	loop_fusion.ml \
	loop_grid_enumerate.ml \
	loop_hoist.ml \
	loop_interchange.ml \
	loop_invariant.ml \
	loop_tile.ml \
	loop_to_unit_steps.ml \
	loop_unroll.ml \
	loop_unswitch.ml \
	pointer_fold.ml \
	reference_fold.ml \
	reference_inline.ml \
	instr_replace.ml \
	instr_replace_fun.ml \
	sequence_delete.ml \
	sequence_elim_around_instr.ml \
	sequence_elim.ml \
	sequence_insert.ml \
	sequence_intro.ml \
	sequence_intro_on_instr.ml \
	sequence_partition.ml \
	struct_fields_reorder.ml \
	struct_inline.ml \
	struct_set_explicit.ml \
	struct_set_implicit.ml \
	typedef_fold.ml \
	typedef_inline.ml \
	typedef_insert.ml \
	variable_fold.ml \
	variable_inline.ml \
	variable_insert.ml \
	variable_insert_and_fold.ml \
	variable_rename.ml\


-->

<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<!---------------------------------------------------------------------------->
<h1>Instructions</h1>




</body>
</html>

<!--

<ul class="spec">
<li>Input: a loop, and a "split-point" in the body of that loop.</li>
<li>Output: a sequence of two loops, each with the same iteration range as the original loop. The first loop executes the first part of the body, whereas the second loop executes the second part of the body.</li>
<li>Assumption: the loop range has a "simple" form.
<li>Correctness: the reordering of the instructions must not change the semantics.</li>
</ul>

-->

